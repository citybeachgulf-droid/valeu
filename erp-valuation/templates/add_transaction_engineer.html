<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>โ ุฅุถุงูุฉ ูุนุงููุฉ - ููุญุฉ ุงููููุฏุณ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { background-color: #f8f9fa; font-family: "Cairo", sans-serif; }
    .card { border-radius: 15px; }
    .table th, .table td { vertical-align: middle; }
  </style>
</head>
<body>

  <!-- โ ุดุฑูุท ุงูุชููู -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">๐๏ธ ูุธุงู ุงูุชุซููู</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('engineer_dashboard') }}">๐ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-danger" href="{{ url_for('logout') }}">๐ช ุชุณุฌูู ุงูุฎุฑูุฌ</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <h2 class="text-center mb-4">โ ุฅุถุงูุฉ ูุนุงููุฉ ุฌุฏูุฏุฉ</h2>

    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card shadow p-4">
          <form method="POST" action="{{ url_for('add_transaction_engineer') }}" enctype="multipart/form-data">
            
            <!-- ๐ค ุงุณู ุงูุนููู -->
            <div class="mb-3">
              <label class="form-label">ุงุณู ุงูุนููู</label>
              <input type="text" name="client_name" class="form-control" required>
            </div>

            <!-- ๐ ููุน ุงููุนุงููุฉ -->
            <div class="mb-3">
              <label class="form-label">ููุน ุงููุนุงููุฉ</label>
              <select name="transaction_type" id="transaction_type" class="form-control" required>
                <option value="">-- ุงุฎุชุฑ ุงูููุน --</option>
                <option value="real_estate">๐ ุนูุงุฑ</option>
                <option value="vehicle">๐ ูุฑูุจุฉ</option>
              </select>
            </div>

            <!-- ๐ฆ ุงูุจูู ููุฑุน ุงูุจูู (ูุดุชุฑูุฉ) -->
            <div class="mb-3">
              <label class="form-label">๐ฆ ุงูุจูู</label>
              <select name="bank_id" class="form-control" required>
                <option value="">-- ุงุฎุชุฑ ุงูุจูู --</option>
                {% for bank in banks %}
                  <option value="{{ bank.id }}">{{ bank.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">๐ฆ ูุฑุน ุงูุจูู</label>
              <input type="text" name="bank_branch" class="form-control" placeholder="ุงูุชุจ ุงุณู ูุฑุน ุงูุจูู" required>
            </div>

            <!-- ๐ ุญููู ุงูุนูุงุฑ -->
            <div id="real_estate_fields" style="display:none;">
              <div class="mb-3">
                <label class="form-label">ุงูููุงูุฉ</label>
                <input type="text" name="state" class="form-control">
              </div>
              <div class="mb-3">
                <label class="form-label">ุงูููุทูุฉ</label>
                <input type="text" name="region" class="form-control">
              </div>
              <div class="mb-3">
                <label class="form-label">ุงููุณุงุญุฉ (ูยฒ)</label>
                <input type="number" step="0.01" name="area" id="area" class="form-control">
              </div>
              <div class="mb-3">
                <label class="form-label">๐ฐ ุณุนุฑ ุงููุชุฑ (ูู ุงูุฐุงูุฑุฉ)</label>
                <input type="number" step="0.01" id="price_per_meter" name="price_per_meter" class="form-control" value="0" readonly>
              </div>
              <h6 class="text-muted">ุชูุงุตูู ุงูุจูุงุก</h6>
              <div class="mb-3">
                <label class="form-label">ูุณุงุญุฉ ุงูุจูุงุก (ูยฒ)</label>
                <input type="number" step="0.01" name="building_area" id="building_area" class="form-control">
              </div>
              <div class="mb-3">
                <label class="form-label">ุนูุฑ ุงูุจูุงุก (ุจุงูุณููุงุช)</label>
                <input type="number" name="building_age" id="building_age" class="form-control">
              </div>
            </div>

            <!-- ๐ ุญููู ุงููุฑูุจุฉ -->
            <div id="vehicle_fields" style="display:none;">
              <div class="mb-3">
                <label class="form-label">ููุน ุงููุฑูุจุฉ</label>
                <input type="text" name="vehicle_type" class="form-control">
              </div>
              <div class="mb-3">
                <label class="form-label">ุงูููุฏูู</label>
                <input type="text" name="vehicle_model" class="form-control">
              </div>
              <div class="mb-3">
                <label class="form-label">ุณูุฉ ุงูุตูุน</label>
                <input type="number" name="vehicle_year" class="form-control">
              </div>
              <div class="mb-3">
                <label class="form-label">ูููุฉ ุงููุฑูุจุฉ</label>
                <input type="number" step="0.01" name="vehicle_value" class="form-control">
              </div>
            </div>

            <!-- ๐ฐ ุงูุฑุณูู -->
            <div class="mb-3">
              <label class="form-label">ุฑุณูู ุงููุนุงููุฉ</label>
              <input type="number" step="0.01" name="fee" class="form-control">
            </div>

            <!-- ๐ ุงููููุงุช -->
            <div class="mb-3">
              <label class="form-label">๐ ูููุงุช ุงููุนุงููุฉ</label>
              <input type="file" name="files" class="form-control" multiple>
            </div>

            <!-- ๐ฉ ุนุฑุถ ุงูุชุซููู -->
            <div id="estimate_box" class="alert alert-info" style="display:none;">
              <b>ุงููููุฉ ุงูุชูุฏูุฑูุฉ ููุฃุฑุถ:</b> <span id="land_value">0</span> ุฑูุงู <br>
              <b>ุงููููุฉ ุงูุชูุฏูุฑูุฉ ููุจูุงุก:</b> <span id="building_value">0</span> ุฑูุงู <br>
              <b>ุงูุฅุฌูุงูู:</b> <span id="total_estimate">0</span> ุฑูุงู
            </div>

            <button type="submit" class="btn btn-primary w-100">๐ ุญูุธ ุงููุนุงููุฉ</button>
          </form>
        </div>
      </div>
    </div>
  </div>

<script>
function calculateEstimate() {
  let area            = parseFloat(document.getElementById("area")?.value) || 0;
  let price_per_meter = parseFloat(document.getElementById("price_per_meter")?.value) || 0;
  let building_area   = parseFloat(document.getElementById("building_area")?.value) || 0;
  let building_age    = parseInt(document.getElementById("building_age")?.value) || 0;

  let land_value = area * price_per_meter;
  let building_value = 0;

if (building_area > 0 && building_age > 0) {
  building_value = building_area * 185 / 50 * (50 - building_age);
}


  let total_estimate = land_value + building_value;

  document.getElementById("land_value").innerText = land_value.toFixed(2);
  document.getElementById("building_value").innerText = building_value.toFixed(2);
  document.getElementById("total_estimate").innerText = total_estimate.toFixed(2);
}

function fetchPrice() {
  let state   = document.querySelector("input[name='state']").value;
  let region  = document.querySelector("input[name='region']").value;
  let bank_id = document.querySelector("select[name='bank_id']").value;

  if (state && region && bank_id) {
    $.post("/get_price", { state, region, bank_id }, function(data) {
      if (data.price_per_meter !== undefined) {
        document.getElementById("price_per_meter").value = data.price_per_meter;
        calculateEstimate();
      }
    });
  }
}

document.getElementById("transaction_type").addEventListener("change", function() {
  let type = this.value;
  document.getElementById("real_estate_fields").style.display = (type === "real_estate") ? "block" : "none";
  document.getElementById("vehicle_fields").style.display   = (type === "vehicle") ? "block" : "none";
  document.getElementById("estimate_box").style.display     = (type === "real_estate") ? "block" : "none";
});

document.querySelector("input[name='state']").addEventListener("input", fetchPrice);
document.querySelector("input[name='region']").addEventListener("input", fetchPrice);
document.querySelector("select[name='bank_id']").addEventListener("change", fetchPrice);
document.querySelectorAll("input").forEach(inp => {
  inp.addEventListener("input", calculateEstimate);
});
calculateEstimate();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
