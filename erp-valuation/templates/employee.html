{% extends 'base.html' %}
{% set title = '๐๏ธ ููุญุฉ ุงูููุธู' %}

{% block head_extra %}
  <style>
    /* --- ุงูุฎุทูุท ูุงูุฃููุงู --- */
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8f9fa; }
    h2, h5, h6 { font-weight: 700; }
    .form-label { font-weight: 500; }
    .card { border-radius: 15px; box-shadow: 0 6px 18px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
    .card:hover { transform: translateY(-4px); }
    .nav-pills .nav-link { border-radius: 50px; margin: 0 4px; }
    .alert-info { border-radius: 12px; background-color: #e7f1ff; color: #0d6efd; }
    .tab-content > .tab-pane { animation: fadeIn 0.5s ease-in-out; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* responsive tweaks */
    @media (max-width: 768px) {
      .card { padding: 15px; }
      .nav-pills { flex-wrap: wrap; justify-content: center; }
    }
  </style>
{% endblock %}

{% block navbar %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm animate__animated animate__fadeInDown">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="#">๐๏ธ ูุธุงู ุงูุชุซููู</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('employee_dashboard') }}">๐ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('customers_page') }}">๐ฅ ุงูุนููุงุก</a></li>
        <li class="nav-item"><a class="nav-link text-warning" href="/reports">๐ ุงูุชูุงุฑูุฑ</a></li>
        <li class="nav-item"><a class="nav-link text-danger" href="{{ url_for('logout') }}">๐ช ุชุณุฌูู ุงูุฎุฑูุฌ</a></li>
      </ul>
    </div>
  </div>
</nav>
{% endblock %}

{% block content %}
<div class="container mt-5">

  <!-- ุนููุงู ุฑุฆูุณู -->
  <h2 class="text-center mb-5" data-aos="fade-up">๐ ููุญุฉ ุงูุจูุงูุงุช</h2>

  <!-- ููุชุฑุฉ ุงููุชุฑุฉ -->
  <form method="GET" class="row g-3 mb-4">
    <div class="col-12 col-md-3">
      <label class="form-label">ูู ุชุงุฑูุฎ</label>
      <input type="date" name="start_date" class="form-control" value="{{ start_date or '' }}">
    </div>
    <div class="col-12 col-md-3">
      <label class="form-label">ุฅูู ุชุงุฑูุฎ</label>
      <input type="date" name="end_date" class="form-control" value="{{ end_date or '' }}">
    </div>
    <div class="col-12 col-md-3 d-flex align-items-end">
      <button class="btn btn-outline-primary w-100">ุชุทุจูู ุงููุชุฑุฉ</button>
    </div>
    <div class="col-12 col-md-3 d-flex align-items-end">
      <a class="btn btn-outline-secondary w-100" href="{{ url_for('employee_dashboard') }}">ูุณุญ ุงูููุชุฑ</a>
    </div>
  </form>

  <!-- ุจุทุงูุงุช ุงูุฅุญุตุงุฆูุงุช -->
  <div class="row mb-4">
    <div class="col-md-6 mb-3">
      <div class="alert alert-secondary shadow-sm rounded-3">
        ๐ ุนุฏุฏ ูุนุงููุงุช ุงูุนูุงุฑ ุงูุชู ุฌูุจุชูุง: <strong>{{ real_estate_brought_count }}</strong>
      </div>
    </div>
    <div class="col-md-6 mb-3">
      <div class="alert alert-secondary shadow-sm rounded-3">
        ๐ ุนุฏุฏ ูุนุงููุงุช ุงูุณูุงุฑุฉ ุงูุชู ุฌูุจุชูุง: <strong>{{ vehicle_brought_count }}</strong>
      </div>
    </div>
  </div>

  <!-- ุชุจููุจุงุช ุงูููุงู -->
  <ul class="nav nav-pills justify-content-center mb-4" id="employeeTabs" role="tablist" data-aos="zoom-in">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="tab-transaction-tab" data-bs-toggle="tab" data-bs-target="#tab-transaction" type="button" role="tab">โ ุฅุถุงูุฉ ูุนุงููุฉ</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-bankdocs-tab" data-bs-toggle="tab" data-bs-target="#tab-bankdocs" type="button" role="tab">๐ฆ ุฅุถุงูุฉ ูุณุชูุฏุงุช ููุจูู</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-branchdocs-tab" data-bs-toggle="tab" data-bs-target="#tab-branchdocs" type="button" role="tab">๐ ูุณุชูุฏุงุช ุงูุดุฑูุฉ/ุงููุฑุน</button>
    </li>
  </ul>

  <div class="tab-content">

    <!-- ุชุจููุจ ุฅุถุงูุฉ ูุนุงููุฉ -->
    <div class="tab-pane fade show active" id="tab-transaction" role="tabpanel">
      <div class="row justify-content-center">
        <div class="col-md-8" data-aos="fade-up">
          <div class="card p-4">
            <h5 class="mb-4">โ ุฅุถุงูุฉ ูุนุงููุฉ ุฌุฏูุฏุฉ</h5>
            <form method="POST" action="{{ url_for('add_transaction') }}" enctype="multipart/form-data">

              <!-- ุจูุงูุงุช ุงูุนููู -->
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">๐ค ุงุณู ุงูุนููู</label>
                  <input type="text" name="client_name" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">๐ ุฑูู ุงูุนููู</label>
                  <input type="text" name="client_phone" class="form-control" required>
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="col-md-6">
                  <label class="form-label">๐ ููุน ุงููุนุงููุฉ</label>
                  <select name="transaction_type" id="transaction_type" class="form-select" required>
                    <option value="">-- ุงุฎุชุฑ ุงูููุน --</option>
                    <option value="real_estate">๐ ุนูุงุฑ</option>
                    <option value="vehicle">๐ ูุฑูุจุฉ</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">๐ฆ ุงูุจูู</label>
                  <select name="bank_id" class="form-select" required>
                    <option value="">-- ุงุฎุชุฑ ุงูุจูู --</option>
                    {% for bank in banks %}
                      <option value="{{ bank.id }}">{{ bank.name }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <!-- ูุนูููุงุช ุฅุถุงููุฉ -->
              <div class="row g-3 mt-2">
                <div class="col-md-6">
                  <label class="form-label">๐ฆ ูุฑุน ุงูุจูู</label>
                  <input type="text" name="bank_branch" class="form-control" placeholder="ุงูุชุจ ุงุณู ูุฑุน ุงูุจูู" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">๐ค ููุธู ุงูุจูู (ุงุฎุชูุงุฑู)</label>
                  <input type="text" name="bank_employee_name" class="form-control">
                </div>
              </div>

              <div class="row g-3 mt-2">
                <div class="col-md-6">
                  <label class="form-label">ูู ุฌูุจ ุงููุนุงููุฉุ</label>
                  <input type="text" name="brought_by" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">ูู ูุงู ุจุงูุฒูุงุฑุฉุ</label>
                  <input type="text" name="visited_by" class="form-control" required>
                </div>
              </div>

              <!-- ุงูุญููู ุงูุฏููุงููููุฉ -->
              <div id="real_estate_fields" style="display:none;" class="mt-3 border-top pt-3">
                <h6>๐ ุชูุงุตูู ุงูุนูุงุฑ</h6>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">ุงูููุงูุฉ</label>
                    <input type="text" name="state" class="form-control" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">ุงูููุทูุฉ</label>
                    <input type="text" name="region" class="form-control" required>
                  </div>
                </div>
                <div class="row g-3 mt-2">
                  <div class="col-md-6">
                    <label class="form-label">ุงููุณุงุญุฉ (ูยฒ)</label>
                    <input type="number" step="0.01" name="area" id="area" class="form-control" required>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">ุณุนุฑ ุงููุชุฑ ุงูููุชุฑุญ</label>
                    <input type="number" step="0.01" name="price_per_meter" id="price_per_meter" class="form-control" readonly>
                  </div>
                </div>
              </div>

              <div id="vehicle_fields" style="display:none;" class="mt-3 border-top pt-3">
                <h6>๐ ุชูุงุตูู ุงููุฑูุจุฉ</h6>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">ููุน ุงููุฑูุจุฉ</label>
                    <input type="text" name="vehicle_type" class="form-control">
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">ุงูููุฏูู</label>
                    <input type="text" name="vehicle_model" class="form-control">
                  </div>
                </div>
              </div>

              <!-- ุงููููุงุช ูุงูุฑุณูู -->
              <div class="row g-3 mt-3">
                <div class="col-md-6">
                  <label class="form-label">๐ต ุฑุณูู ุงููุนุงููุฉ</label>
                  <input type="number" step="0.01" name="fee" class="form-control">
                </div>
                <div class="col-md-6">
                  <label class="form-label">๐ ูููุงุช ุงููุนุงููุฉ</label>
                  <input type="file" name="files" class="form-control" multiple>
                </div>
              </div>

              <div id="estimate_box" class="alert alert-info mt-3" style="display:none;">
                <b>ุงููููุฉ ุงูุชูุฏูุฑูุฉ ููุฃุฑุถ:</b> <span id="land_value">0</span> ุฑูุงู <br>
                <b>ุงููููุฉ ุงูุชูุฏูุฑูุฉ ููุจูุงุก:</b> <span id="building_value">0</span> ุฑูุงู <br>
                <b>ุงูุฅุฌูุงูู:</b> <span id="total_estimate">0</span> ุฑูุงู
              </div>

              <button type="submit" class="btn btn-primary w-100 mt-3">๐ ุญูุธ ุงููุนุงููุฉ ูุฅุดุนุงุฑ ุงููููุฏุณ</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- ุชุจููุจ ูุณุชูุฏุงุช ุงูุจูู -->
    <div class="tab-pane fade" id="tab-bankdocs" role="tabpanel">
      <div class="row justify-content-center mt-3">
        <div class="col-md-8" data-aos="fade-up">
          <div class="card p-3 shadow-sm">
            <h5 class="mb-3">โ๏ธ ุฅุฑุณุงู ุฑุณุงูุฉ/ุณูุฑุฉ ุฐุงุชูุฉ ููุจูู (ุจุฏูู ูุนุงููุฉ)</h5>
            <form class="row g-2" method="POST" action="{{ url_for('employee_add_bank_document') }}" enctype="multipart/form-data">
              <div class="col-md-4">
                <label class="form-label">๐ฆ ุงุฎุชุฑ ุงูุจูู</label>
                <select name="bank_id" class="form-select" required>
                  <option value="">โ ุงุฎุชุฑ ุงูุจูู โ</option>
                  {% for bank in banks %}
                    <option value="{{ bank.id }}">{{ bank.name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="col-md-8">
                <label class="form-label">ุงูุนููุงู</label>
                <input type="text" name="title" class="form-control" required>
              </div>
              <div class="col-md-8">
                <label class="form-label">ููู ูุฑูู (ุงุฎุชูุงุฑู)</label>
                <input type="file" name="file" class="form-control">
              </div>
              <div class="col-md-4 d-flex align-items-end">
                <button class="btn btn-primary w-100">ุฅุฑุณุงู</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- ุชุจููุจ ูุณุชูุฏุงุช ุงููุฑุน -->
    <div class="tab-pane fade" id="tab-branchdocs" role="tabpanel">
      <div class="row justify-content-center mt-3">
        <div class="col-md-10" data-aos="fade-up">
          <div class="card p-4 shadow-lg">
            <h5 class="mb-3">๐ ูุณุชูุฏุงุช ุงูุดุฑูุฉ/ุงููุฑุน</h5>
            <!-- ูููุฐุฌ ุฑูุน ูุณุชูุฏ -->
            <form method="POST" action="{{ url_for('employee_add_branch_document') }}" enctype="multipart/form-data" class="mb-3">
              <div class="row g-2">
                <div class="col-md-4">
                  <label class="form-label">ุนููุงู ุงููุณุชูุฏ</label>
                  <input type="text" name="title" class="form-control" required>
                </div>
                <div class="col-md-4">
                  <label class="form-label">ููุน ุงููุณุชูุฏ</label>
                  <input type="text" name="doc_type" class="form-control" placeholder="ุณุฌู ุชุฌุงุฑูุ ุถุฑูุจุฉุ ..">
                </div>
                <div class="col-md-2">
                  <label class="form-label">ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ</label>
                  <input type="date" name="issued_at" class="form-control">
                </div>
                <div class="col-md-2">
                  <label class="form-label">ุชุงุฑูุฎ ุงูุงูุชูุงุก</label>
                  <input type="date" name="expires_at" class="form-control">
                </div>
                <div class="col-md-10 mt-2">
                  <label class="form-label">ุงูููู</label>
                  <input type="file" name="file" class="form-control">
                </div>
                <div class="col-md-2 mt-2 d-flex align-items-end">
                  <button class="btn btn-success w-100">โฌ๏ธ ุฑูุน ุงููุณุชูุฏ</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูููุฏ ุงูุณุงุจู ููุญููู ุงูุฏููุงููููุฉ ูุงูุญุณุงุจ ุงูุชูุฏูุฑู
  const typeSelect = document.getElementById("transaction_type");
  const realFields = document.getElementById("real_estate_fields");
  const vehicleFields = document.getElementById("vehicle_fields");
  const estimateBox = document.getElementById("estimate_box");

  function toggleTypeFields() {
    const val = typeSelect.value;
    realFields.style.display = val === 'real_estate' ? 'block' : 'none';
    vehicleFields.style.display = val === 'vehicle' ? 'block' : 'none';
    estimateBox.style.display = val === 'real_estate' ? 'block' : 'none';
  }
  typeSelect.addEventListener('change', toggleTypeFields);
  toggleTypeFields();
</script>
{% endblock %}
