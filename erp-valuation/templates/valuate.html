<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
   <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">ğŸ› ï¸ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ«Ù…ÙŠÙ†</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <!-- Ø²Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('engineer_dashboard') }}">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        </li>
        <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ -->
        <li class="nav-item">
          <a class="nav-link text-danger" href="{{ url_for('logout') }}">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
  <meta charset="UTF-8">
  <title>ğŸ’° ØªØ«Ù…ÙŠÙ† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<!-- Ù†Ù…Ø±Ù‘Ø± Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ù…Ù† Jinja Ø¹Ø¨Ø± data-transaction-area Ù„ØªØ¬Ù†Ù‘Ø¨ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø­Ø±Ù‘Ø± JavaScript -->
<body class="container mt-4" data-transaction-area="{{ t.area or 0 }}">

  <h3>ğŸ’° ØªØ«Ù…ÙŠÙ† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø±Ù‚Ù… {{ t.id }}</h3>

  <div class="card mb-3">
    <div class="card-body">
      <p><strong>ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> {{ t.client }}</p>
      <p><strong>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> {{ t.date.strftime('%Y-%m-%d %H:%M') }}</p>
      <p><strong>ğŸ“ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©:</strong> {{ t.state }} | <strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> {{ t.region }}</p>
      <p><strong>ğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ:</strong> {{ t.bank.name if t.bank else "ØºÙŠØ± Ù…Ø­Ø¯Ø¯" }}</p>
      <p><strong>ğŸ  Ø§Ù„Ù…Ø³Ø§Ø­Ø©:</strong> {{ t.area }} Ù…Â²</p>
      <p><strong>ğŸ“‚ Ø§Ù„Ù…Ù„ÙØ§Øª:</strong> {{ t.files }}</p>
      <p><strong>ğŸ’µ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> {{ t.fee }}</p>
      <p><strong>ğŸ“Œ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong> {{ t.status }}</p>
    </div>
  </div>

<form method="POST" action="{{ url_for('valuate_transaction', tid=t.id) }}">
    <!-- Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ± Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© -->
    <div class="mb-3">
      <label class="form-label">ğŸ’° Ø³Ø¹Ø± Ø§Ù„Ù…ØªØ± (Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©)</label>
      <input type="number" step="0.01" id="saved_price" class="form-control" value="{{ saved_price or 0 }}">
      <small class="text-muted">ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡ ÙˆØ³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ§Ù„ÙˆÙ„Ø§ÙŠØ© ÙˆØ§Ù„Ø¨Ù†Ùƒ</small>
    </div>

    <div class="mb-3">
      <label class="form-label">ğŸ’° Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£Ø±Ø¶</label>
      <input type="number" step="0.01" name="land_value" id="land_value" class="form-control" value="{{ t.land_value or 0 }}">
    </div>

    <div class="mb-3">
      <label class="form-label">ğŸ¢ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡</label>
      <input type="number" step="0.01" name="building_value" id="building_value" class="form-control" value="{{ t.building_value or 0 }}">
    </div>

    <div class="mb-3">
      <label class="form-label">ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
      <input type="text" id="total_estimate" class="form-control" value="{{ t.total_estimate or 0 }}" readonly>
    </div>

    <button type="submit" class="btn btn-success">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ«Ù…ÙŠÙ†</button>
    <a href="{{ url_for('manager_dashboard') }}" class="btn btn-secondary">â¬… Ø±Ø¬ÙˆØ¹</a>
  </form>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Ù†Ù‚Ø±Ø£ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ù…Ù† data-attribute Ø¨Ø¯Ù„ Jinja Ø¯Ø§Ø®Ù„ Ø³ÙƒØ±Ø¨Øª
      const transactionArea = parseFloat(document.body.dataset.transactionArea || "0");

      const savedPriceInput    = document.getElementById("saved_price");
      const landValueInput     = document.getElementById("land_value");
      const buildingValueInput = document.getElementById("building_value");
      const totalInput         = document.getElementById("total_estimate");

      function toNumber(v) {
        const n = parseFloat(v);
        return isNaN(n) ? 0 : n;
      }

      function updateLandValue() {
        if (!savedPriceInput || !landValueInput) return;
        const price = toNumber(savedPriceInput.value);
        landValueInput.value = (transactionArea * price).toFixed(2);
        updateTotal();
      }

      function updateTotal() {
        if (!landValueInput || !buildingValueInput || !totalInput) return;
        const land     = toNumber(landValueInput.value);
        const building = toNumber(buildingValueInput.value);
        totalInput.value = (land + building).toFixed(2);
      }

      if (savedPriceInput) {
        savedPriceInput.addEventListener("input", updateLandValue);
        savedPriceInput.addEventListener("change", updateLandValue);
      }
      if (landValueInput)      landValueInput.addEventListener("input", updateTotal);
      if (buildingValueInput)  buildingValueInput.addEventListener("input", updateTotal);

      // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø£ÙˆÙ„ÙŠ Ø¢Ù…Ù†
      if (savedPriceInput) {
        updateLandValue();
      } else {
        updateTotal();
      }
    });
  </script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
