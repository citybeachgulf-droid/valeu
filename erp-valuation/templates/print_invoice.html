<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ§¾ Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø©</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/print-invoice.css') }}">
</head>
<body>
  <div class="invoice-container">
    <div class="card">
      <div class="header">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <div class="org-name">{{ org_name or 'Ø´Ø±ÙƒØ© Ø§Ù„ØªØ«Ù…ÙŠÙ†' }}</div>
            <div class="org-meta">{{ org_meta or 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Â· Ø§Ù„Ù‡Ø§ØªÙ Â· Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ' }}</div>
          </div>
        </div>
        <div class="text-end">
          <div class="badge">{{ badge_label or 'ÙØ§ØªÙˆØ±Ø©' }}</div>
          <div class="meta-grid mt-2">
            <div><span class="section-title">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span><div class="fw-bold">{{ invoice_code or ('INV-' ~ (transaction.id if transaction else '')) }}</div></div>
            <div><span class="section-title">Ø§Ù„ØªØ§Ø±ÙŠØ®</span><div class="fw-bold">{{ date_str }}</div></div>
            <div><span class="section-title">Ø§Ù„Ù…Ø±Ø¬Ø¹</span><div class="fw-bold">{{ reference_code or 'INV-CUST' }}</div></div>
            <div><span class="section-title">Ø§Ù„Ù…ÙˆØ¸Ù</span><div class="fw-bold">{{ employee_name or (transaction.employee if transaction else '-') }}</div></div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="grid-2">
          <div class="info-box">
            <div class="label">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
            <div class="value">{{ client_name or (transaction.client if transaction else '-') }}</div>
            {% if bank_name %}<div class="org-meta">Ø§Ù„Ø¨Ù†Ùƒ: {{ bank_name }}{% if transaction and transaction.bank_branch %} Â· Ø§Ù„ÙØ±Ø¹: {{ transaction.bank_branch }}{% endif %}</div>{% endif %}
          </div>
          <div class="info-box">
            <div class="label">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±/Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</div>
            {% if transaction %}
              <div class="org-meta">Ø§Ù„ÙˆÙ„Ø§ÙŠØ©: {{ transaction.state or '-' }} Â· Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: {{ transaction.region or '-' }}</div>
              <div class="org-meta">Ø§Ù„Ù…Ø³Ø§Ø­Ø©: {{ transaction.area or 0 }} Ù…Â² Â· Ø§Ù„Ù…Ø¨Ù†Ù‰: {{ transaction.building_area or 0 }} Ù…Â² Â· Ø¹Ù…Ø± Ø§Ù„Ù…Ø¨Ù†Ù‰: {{ transaction.building_age or 0 }}</div>
            {% else %}
              <div class="org-meta">â€”</div>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="panel">
        <table class="items">
          <thead>
            <tr>
              <th style="width:160px">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
              <th style="width:160px">Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>
              <th style="width:120px">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
              <th>Ø§Ù„ÙˆØµÙ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{ amount | round(2) }}</td>
              <td>{{ amount | round(2) }}</td>
              <td>1</td>
              <td>Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ«Ù…ÙŠÙ†{% if transaction and transaction.status %} - {{ transaction.status }}{% elif notes %} - {{ notes }}{% endif %}</td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="4">
                <div class="totals">
                  <div>
                    <div class="section-title mb-2">Ù…Ù„Ø®Øµ</div>
                    <div class="summary-row"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ</span><span>{{ amount | round(2) }}</span></div>
                    <div class="summary-row"><span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ({{ (vat_rate * 100) | round(2) }}%)</span><span>{{ tax | round(2) }}</span></div>
                    <div class="summary-row" style="font-weight:700"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span><span>{{ total_with_tax | round(2) }}</span></div>
                  </div>
                  <div>
                    {% if transaction and transaction.total_estimate %}
                      <div class="section-title mb-2">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</div>
                      <div class="summary-row"><span>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£Ø±Ø¶</span><span>{{ (transaction.land_value or 0) | round(2) }}</span></div>
                      <div class="summary-row"><span>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¨Ù†Ù‰</span><span>{{ (transaction.building_value or 0) | round(2) }}</span></div>
                      <div class="summary-row"><span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</span><span>{{ (transaction.total_estimate or 0) | round(2) }}</span></div>
                    {% else %}
                      <div class="section-title">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
                      <div class="org-meta">{{ notes or 'â€”' }}</div>
                    {% endif %}
                  </div>
                </div>
              </td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="panel no-print">
        <div class="actions">
          <button class="btn" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
          <a class="btn secondary" href="{{ url_for('finance_dashboard') }}">â†©ï¸ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ø§Ù„ÙŠØ©</a>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Auto-open print dialog if requested via query string
    (function(){
      try {
        var usp = new URLSearchParams(window.location.search);
        if (usp.get('auto') === '1') { setTimeout(function(){ window.print(); }, 300); }
      } catch (e) {}
    })();
  </script>
</body>
</html>

