{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 class="mb-0">ุชูุงุตูู ุงููุงุชูุฑุฉ #{{ invoice.id }}</h3>
    <a href="{{ url_for('consulting_invoices.list_invoices') }}" class="btn btn-secondary">โฉ๏ธ ุฑุฌูุน</a>
  </div>

  <div class="row g-3">
    <div class="col-md-4">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title mb-3">ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ</h5>
          <div class="mb-2"><strong>ุงููุดุฑูุน:</strong> {{ invoice.project.name if invoice.project else '-' }}</div>
          <div class="mb-2"><strong>ุงูุนููู:</strong> {{ invoice.client.name if invoice.client else '-' }}</div>
          <div class="mb-2"><strong>ุงูุนูุฏ:</strong> {{ invoice.contract.contract_number if invoice.contract else 'โ' }}</div>
          <div class="mb-2"><strong>ุงููุจูุบ:</strong> {{ '%.2f'|format(invoice.amount) }}</div>
          <div class="mb-2"><strong>ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ:</strong> {{ invoice.issue_date.strftime('%Y-%m-%d') if invoice.issue_date else '-' }}</div>
          <div class="mb-2"><strong>ุชุงุฑูุฎ ุงูุงุณุชุญูุงู:</strong> {{ invoice.due_date.strftime('%Y-%m-%d') if invoice.due_date else '-' }}
            {% if invoice.is_overdue() %}
              <span class="badge bg-danger ms-1">ูุชุฃุฎุฑุฉ</span>
            {% endif %}
          </div>
          <div class="mb-2"><strong>ุงูุญุงูุฉ:</strong> {{ invoice.status }}</div>
          <div class="mb-2"><strong>ุชุงุฑูุฎ ุงูุณุฏุงุฏ:</strong> {{ invoice.paid_date.strftime('%Y-%m-%d') if invoice.paid_date else 'โ' }}</div>
          <div class="mb-0"><strong>ููุงุญุธุงุช:</strong><br>{{ invoice.notes or 'โ' }}</div>
        </div>
      </div>
    </div>

    <div class="col-md-8">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title mb-3">ุชุญุฏูุซ ุญุงูุฉ ุงูุฏูุน</h5>
          <form method="post" action="{{ url_for('consulting_invoices.update_invoice_status', invoice_id=invoice.id) }}" class="row g-3">
            <div class="col-md-6">
              <label class="form-label">ุงูุญุงูุฉ</label>
              <select name="status" class="form-select">
                {% for s in INVOICE_STATUSES %}
                  <option value="{{ s }}" {% if invoice.status == s %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">ุชุงุฑูุฎ ุงูุณุฏุงุฏ (ุงุฎุชูุงุฑู)</label>
              <input type="date" name="paid_date" class="form-control" value="{{ invoice.paid_date.strftime('%Y-%m-%d') if invoice.paid_date else '' }}">
              <div class="form-text">ุฅุฐุง ูุงูุช ุงูุญุงูุฉ "ูุฏููุนุฉ" ููู ุชุฏุฎู ุชุงุฑูุฎูุงุ ุณูุชู ุงุณุชุฎุฏุงู ุชุงุฑูุฎ ุงูููู.</div>
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary">๐พ ุญูุธ</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
